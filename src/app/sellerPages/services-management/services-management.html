<div class="space-y-6">
  <!-- Header Section -->
  <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div>
      <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
        {{ getTranslation('title') }}
      </h1>
      <p class="text-gray-600 dark:text-gray-400">
        {{ getTranslation('subtitle') }}
      </p>
    </div>
    <button
      (click)="openCreateModal()"
      class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center gap-2"
      aria-label="Add new service"
    >
      <i class="fa-solid fa-plus w-4 h-4"></i>
      {{ getTranslation('addService') }}
    </button>
  </header>


  <!-- Stats Cards Section -->
  <section class="grid grid-cols-1 md:grid-cols-3 gap-4 pb-4">
    <article class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
      <div class="flex items-center">
        <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/50 rounded-lg flex items-center justify-center">
          <i class="fas fa-tools text-blue-600 dark:text-blue-400" aria-hidden="true"></i>
        </div>
        <div class="ml-3 rtl:mr-3 rtl:ml-0">
          <p class="text-sm font-medium text-gray-600 dark:text-gray-400">
            {{ getTranslation('totalServices') }}
          </p>
          <p class="text-xl font-bold text-gray-900 dark:text-white">{{ services.length }}</p>
        </div>
      </div>
    </article>

    <article class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
      <div class="flex items-center">
        <div class="w-10 h-10 bg-green-100 dark:bg-green-900/50 rounded-lg flex items-center justify-center">
          <i class="fas fa-check-circle text-green-600 dark:text-green-400" aria-hidden="true"></i>
        </div>
        <div class="ml-3 rtl:mr-3 rtl:ml-0">
          <p class="text-sm font-medium text-gray-600 dark:text-gray-400">
            {{ getTranslation('activeServices') }}
          </p>
          <p class="text-xl font-bold text-gray-900 dark:text-white">{{ getActiveServicesCount() }}</p>
        </div>
      </div>
    </article>

    <article class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4">
      <div class="flex items-center">
        <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/50 rounded-lg flex items-center justify-center">
          <i class="fas fa-star text-purple-600 dark:text-purple-400" aria-hidden="true"></i>
        </div>
        <div class="ml-3 rtl:mr-3 rtl:ml-0">
          <p class="text-sm font-medium text-gray-600 dark:text-gray-400">
            {{ getTranslation('totalOrders') }}
          </p>
          <p class="text-xl font-bold text-gray-900 dark:text-white">{{ getTotalRating() }}</p>
        </div>
      </div>
    </article>
  </section>

  <!-- Main Content Section -->
  <main>
    <!-- Show loading indicator -->
    <div *ngIf="isLoading && services.length === 0" class="flex justify-center items-center py-16">
      <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-600"></div>
    </div>

    <!-- Show Data Table if services exist -->
    <ng-container *ngIf="services.length > 0 && !isLoading">
      <app-data-table
        [data]="services"
        [columns]="columns"
        [actions]="actions"
        [searchPlaceholder]="getTranslation('searchServices')"
        (actionClicked)="onAction($event)"
        (exportClicked)="onExport()"
      ></app-data-table>
    </ng-container>

    <!-- No Services Template -->
    <ng-template #noServices>
      <div class="flex flex-col items-center justify-center text-center py-16 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700">
        <i class="fas fa-box-open text-5xl text-gray-400 dark:text-gray-600 mb-4"></i>
        <h2 class="text-xl font-semibold text-gray-700 dark:text-white mb-2">
          {{ getTranslation('noServices') || 'No services found' }}
        </h2>
        <p class="text-gray-500 dark:text-gray-400 mb-6">
          {{ getTranslation('noServicesMessage') || "You haven't added any services yet. Start by creating one." }}
        </p>
        <button
          (click)="openCreateModal()"
          class="px-5 py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 flex items-center gap-2"
        >
          <i class="fa-solid fa-plus w-4 h-4"></i>
          {{ getTranslation('addService') }}
        </button>
      </div>
    </ng-template>
  </main>

  <!-- Service Form Modal -->
  <app-modal
    [isOpen]="showModal"
    [title]="modalTitle"
    [confirmText]="isLoading ? '' : (isEditing ? getTranslation('update') : getTranslation('create'))"
    (closed)="closeModal()"
    (confirmed)="saveService()"
    aria-labelledby="service-form-title"
  >
  <div *ngIf="isLoading" class="absolute inset-0 bg-white/50 dark:bg-gray-800/50 flex items-center justify-center z-10">
    <div class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-green-600"></div>
  </div>
    <form class="space-y-4" *ngIf="currentService" (ngSubmit)="saveService()">
      <fieldset class="space-y-4">
        <legend class="sr-only">Service Information</legend>
        
        <!-- Service Title -->
        <div>
          <label for="serviceTitle" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            {{ getTranslation('serviceTitle') }}
          </label>
          <input
            type="text"
            id="serviceTitle"
            [(ngModel)]="currentService.Title"
            name="Title"
            required
            [class.border-red-500]="formErrors['Title']"
            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
          />
          <p *ngIf="formErrors['Title']" class="mt-1 text-sm text-red-600 dark:text-red-400">
            {{ formErrors['Title'] }}
          </p>
        </div>

        <!-- Description -->
        <div>
          <label for="serviceDescription" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            {{ getTranslation('description') }}
          </label>
          <textarea
            id="serviceDescription"
            [(ngModel)]="currentService.Description"
            name="Description"
            rows="3"
            required
            [class.border-red-500]="formErrors['Description']"
            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
          ></textarea>
          <p *ngIf="formErrors['Description']" class="mt-1 text-sm text-red-600 dark:text-red-400">
            {{ formErrors['Description'] }}
          </p>
        </div>

        <!-- Price and Duration -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="servicePrice" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              {{ getTranslation('price') }}
            </label>
            <input
              type="number"
              id="servicePrice"
              [(ngModel)]="currentService.BasePrice"
              name="BasePrice"
              min="0"
              step="0.01"
              required
              [class.border-red-500]="formErrors['BasePrice']"
              class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
            />
            <p *ngIf="formErrors['BasePrice']" class="mt-1 text-sm text-red-600 dark:text-red-400">
              {{ formErrors['BasePrice'] }}
            </p>
          </div>

          <div>
            <label for="serviceDuration" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
              {{ getTranslation('duration') }}
            </label>
            <input
              type="number"
              id="serviceDuration"
              [(ngModel)]="currentService.DeliveryTime"
              name="DeliveryTime"
              min="0"
              required
              [class.border-red-500]="formErrors['DeliveryTime']"
              class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
            />
            <p *ngIf="formErrors['DeliveryTime']" class="mt-1 text-sm text-red-600 dark:text-red-400">
              {{ formErrors['DeliveryTime'] }}
            </p>
          </div>
        </div>

        <!-- Category -->
        <div>
          <label for="serviceCategory" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            {{ getTranslation('category') }}
          </label>
          <select
            id="serviceCategory"
            [(ngModel)]="currentService.CategoryId"
            name="CategoryId"
            required
            [class.border-red-500]="formErrors['CategoryId']"
            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
          >
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
          <p *ngIf="formErrors['CategoryId']" class="mt-1 text-sm text-red-600 dark:text-red-400">
            {{ formErrors['CategoryId'] }}
          </p>
        </div>

        <!-- Image Upload -->
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
            Service Image
          </label>

          <!-- Image Preview -->
          <div class="mb-4" *ngIf="currentImage">
            <img 
              [src]="currentImage" 
              alt="Service preview"
              class="h-32 w-32 object-cover rounded-lg"
            >
          </div>

          <!-- File Input -->
          <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
            <label for="fileInput" class="cursor-pointer">
              <span class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 flex items-center gap-2">
                <i class="fas fa-upload w-4 h-4" aria-hidden="true"></i>
                {{ currentImage ? 'Change Image' : 'Upload Image' }}
              </span>
              <input 
                type="file" 
                id="fileInput"
                (change)="onFileSelected($event)"
                accept="image/*"
                class="hidden"
              >
            </label>

            <button 
              type="button" 
              *ngIf="currentImage"
              (click)="resetFileInput()"
              class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200 flex items-center gap-2"
            >
              <i class="fas fa-trash w-4 h-4" aria-hidden="true"></i>
              Remove
            </button>
          </div>

          <p *ngIf="formErrors['image']" class="mt-1 text-sm text-red-600 dark:text-red-400">
            {{ formErrors['image'] }}
          </p>
          <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
            {{ getTranslation('validation.maxFileSize') }}. {{ getTranslation('validation.invalidFileType') }}
          </p>
        </div>
      </fieldset>
    </form>
  </app-modal>

  <!-- Delete Confirmation Modal -->
  <app-modal
    [isOpen]="showDeleteModal"
    [title]="getTranslation('deleteService')"
    [confirmText]="isLoading ? '' : getTranslation('delete')"
    confirmButtonType="danger"
    (closed)="closeDeleteModal()"
    (confirmed)="confirmDelete()"
    aria-labelledby="delete-confirmation-title"
  >
    <div *ngIf="isLoading" class="absolute inset-0 bg-white/50 dark:bg-gray-800/50 flex items-center justify-center z-10">
    <div class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-green-600"></div>
  </div>
    <div class="text-center">
      <div class="w-12 h-12 bg-red-100 dark:bg-red-900/50 rounded-full flex items-center justify-center mx-auto mb-4">
        <i class="fas fa-trash w-6 h-6 text-red-600 dark:text-red-400" aria-hidden="true"></i>
      </div>
      <h2 id="delete-confirmation-title" class="text-lg font-medium text-gray-900 dark:text-white mb-2">
        {{ getTranslation('deleteConfirm') }}
      </h2>
      <p class="text-gray-500 dark:text-gray-400">
        {{ getTranslation('deleteMessage') }}
      </p>
    </div>
  </app-modal>
</div>