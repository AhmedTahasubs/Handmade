<div class="min-h-screen bg-gray-50 dark:bg-gray-900" [attr.dir]="languageService.currentLanguage()">
  
  <!-- Loading Spinner -->
  <div *ngIf="loading" class="flex items-center justify-center min-h-screen">
    <div class="w-12 h-12 border-b-2 border-blue-600 rounded-full animate-spin"></div>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading && service" class="pb-8">
    
    <!-- Back Button -->
    <div class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
      <div class="px-4 py-4 mx-auto max-w-7xl sm:px-6 lg:px-8">
        <button 
          (click)="goBackToServices()"
          class="flex items-center gap-2 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 transition">
          <i class="fas fa-arrow-left" [class.fa-arrow-right]="currentLanguage === 'ar'"></i>
          {{ labels.back_to_services }}
        </button>
      </div>
    </div>

    <div class="px-4 py-8 mx-auto max-w-7xl sm:px-6 lg:px-8 grid gap-8 lg:grid-cols-3">
      
      <!-- LEFT MAIN CONTENT -->
      <div class="space-y-8 lg:col-span-2">
        
        <!-- Service Header -->
        <div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-800 flex flex-col md:flex-row gap-6">
          
          <!-- Image Gallery -->
          <div class="md:w-1/2">
            <div class="relative overflow-hidden rounded-lg aspect-square">
              <img [src]="service.gallery[activeGalleryImage]" [alt]="service.title" class="object-cover w-full h-full" />
              <!-- Gallery Bullets -->
              <div class="absolute flex gap-2 -translate-x-1/2 bottom-4 left-1/2">
                <button 
                  *ngFor="let img of service.gallery; let i = index"
                  (click)="selectGalleryImage(i)"
                  class="w-3 h-3 rounded-full transition"
                  [class.bg-white]="i === activeGalleryImage"
                  [class.bg-gray-400]="i !== activeGalleryImage">
                </button>
              </div>
            </div>
            <!-- Thumbnails -->
            <div class="flex gap-2 mt-4 overflow-x-auto">
              <button 
                *ngFor="let img of service.gallery; let i = index"
                (click)="selectGalleryImage(i)"
                class="flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 transition"
                [class.border-blue-500]="i === activeGalleryImage"
                [class.border-gray-200]="i !== activeGalleryImage"
                [class.dark:border-gray-600]="i !== activeGalleryImage">
                <img [src]="img" class="object-cover w-full h-full">
              </button>
            </div>
          </div>

          <!-- Service Info -->
          <div class="md:w-1/2 flex flex-col justify-between">
            <div>
              <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-4">
                {{ service.title }}
              </h1>
              
              <!-- Rating -->
              <div class="flex items-center gap-3 mb-4">
                <div class="flex">
                  <ng-container *ngFor="let star of getStarArray(); let i = index">
                    <i class="fas fa-star text-yellow-400 text-sm" *ngIf="isStarFilled(i, service.rating)"></i>
                    <i class="fas fa-star-half-alt text-yellow-400 text-sm" *ngIf="isStarHalf(i, service.rating)"></i>
                    <i class="far fa-star text-gray-300 text-sm" *ngIf="!isStarFilled(i, service.rating) && !isStarHalf(i, service.rating)"></i>
                  </ng-container>
                </div>
                <span class="font-semibold text-gray-900 dark:text-white">{{ service.rating }}</span>
                <span class="text-gray-600 dark:text-gray-400">({{ service.reviewCount }} reviews)</span>
              </div>

              <!-- Seller Quick Info -->
              <div class="flex items-center gap-3 p-4 rounded-lg bg-gray-50 dark:bg-gray-700 mb-6">
                <img [src]="service.sellerInfo.avatar" class="w-12 h-12 rounded-full border-2 border-white dark:border-gray-600" />
                <div class="flex-1">
                  <button (click)="goToSellerProfile()" class="font-medium text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400">
                    {{ service.sellerInfo.name }}
                  </button>
                  <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                    <span *ngIf="service.sellerInfo.isVerified" class="text-green-600 dark:text-green-400">
                      <i class="fas fa-check-circle"></i> {{ labels.verified }}
                    </span>
                    <span class="px-2 py-1 text-xs rounded-full"
                          [ngClass]="service.sellerInfo.isOnline 
                            ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'
                            : 'bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-300'">
                      {{ service.sellerInfo.isOnline ? labels.online : 'Offline' }}
                    </span>
                  </div>
                </div>
              </div>

              <!-- Key Info -->
              <div class="space-y-2 text-sm">
                <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400">
                  <i class="fas fa-dollar-sign text-blue-500"></i>
                  <span>{{ labels.starting_at }} ${{ selectedPackage?.price || service.price }}</span>
                </div>
                <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400">
                  <i class="fas fa-clock text-blue-500"></i>
                  <span>{{ labels.delivery_time }}: {{ selectedPackage?.deliveryTime || service.deliveryTime }}</span>
                </div>
                <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400">
                  <i class="fas fa-redo text-blue-500"></i>
                  <span>{{ selectedPackage?.revisions || 'Unlimited' }} {{ labels.revisions }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Service Packages -->
        <div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-800">
          <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-6">{{ labels.packages }}</h2>
          <div class="grid md:grid-cols-3 gap-4">
            <div *ngFor="let pkg of service.packages"
                 (click)="selectPackage(pkg)"
                 class="p-6 rounded-lg border cursor-pointer transition relative"
                 [ngClass]="selectedPackage?.id === pkg.id 
                    ? 'border-blue-500 bg-blue-50 dark:border-blue-400 dark:bg-blue-900'
                    : 'border-gray-200 dark:border-gray-600'">
              <div *ngIf="pkg.isPopular" class="absolute -top-3 left-1/2 -translate-x-1/2">
                <span class="px-3 py-1 text-xs text-white bg-orange-500 rounded-full">
                  {{ labels.popular }}
                </span>
              </div>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white text-center">{{ pkg.name[currentLanguage] }}</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400 text-center mb-4">{{ pkg.description[currentLanguage] }}</p>
              <div class="text-2xl font-bold text-blue-600 dark:text-blue-400 text-center mb-4">${{ pkg.price }}</div>
              <div class="text-sm text-gray-600 dark:text-gray-400 text-center mb-4">{{ pkg.deliveryTime }} â€¢ {{ pkg.revisions }} revisions</div>
              <ul class="space-y-2 text-sm">
                <li *ngFor="let feature of pkg.features[currentLanguage]" class="flex items-center gap-2">
                  <i class="fas fa-check text-green-500"></i> 
                  <span class="text-gray-700 dark:text-gray-300">{{ feature }}</span>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- About Service -->
        <div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-800">
          <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">{{ labels.about_service }}</h2>
          <p class="text-gray-700 dark:text-gray-300">{{ service.fullDescription[currentLanguage] }}</p>
        </div>

        <!-- Features -->
        <div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-800">
          <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">{{ labels.service_features }}</h2>
          <div class="grid md:grid-cols-2 gap-4">
            <div *ngFor="let feature of service.features[currentLanguage]" class="flex items-center gap-3">
              <i class="fas fa-check-circle text-green-500"></i>
              <span class="text-gray-700 dark:text-gray-300">{{ feature }}</span>
            </div>
          </div>
        </div>

        <!-- Seller Products -->
        <div *ngIf="displayedSellerProducts.length > 0">
          <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">{{ labels.Service_products }}</h2>
          <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <app-product-card *ngFor="let product of displayedSellerProducts"
              [product]="product"
              [language]="currentLanguage"
              (addToCart)="onAddToCart($event)"
              (addToWishlist)="onAddToWishlist($event)">
            </app-product-card>
          </div>
          <div class="mt-4 text-right">
            <button (click)="viewAllSellerProducts()" class="text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 text-sm">
              {{ labels.view_all_products }}
            </button>
          </div>
        </div>

        <!-- FAQ -->
        <div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-800" *ngIf="service.faq.length">
          <h2 class="text-xl font-bold mb-6 text-gray-900 dark:text-white">{{ labels.faq }}</h2>
          <div class="space-y-4">
            <div *ngFor="let faq of service.faq" class="border rounded-lg dark:border-gray-600">
              <button 
                (click)="toggleFAQ(faq.id)"
                class="flex justify-between items-center w-full px-6 py-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                <span class="font-medium text-gray-900 dark:text-white">{{ faq.question[currentLanguage] }}</span>
                <i class="fas fa-chevron-down transition-transform" [class.rotate-180]="expandedFAQ === faq.id"></i>
              </button>
              <div *ngIf="expandedFAQ === faq.id" class="px-6 pb-4 text-gray-700 dark:text-gray-300">
                {{ faq.answer[currentLanguage] }}
              </div>
            </div>
          </div>
        </div>

        <!-- Reviews -->
        <div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-800">
          <h2 class="text-xl font-bold mb-6 text-gray-900 dark:text-white">{{ labels.reviews }} ({{ reviews.length }})</h2>
          <div class="space-y-6">
            <app-review-item *ngFor="let review of reviews" [review]="review" [language]="currentLanguage"></app-review-item>
          </div>
        </div>

        <!-- Related Services -->
        <div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-800" *ngIf="relatedServices.length">
          <h2 class="text-xl font-bold mb-6 text-gray-900 dark:text-white">{{ labels.related_services }}</h2>
          <div class="grid md:grid-cols-2 gap-6">
            <div *ngFor="let relatedService of relatedServices" (click)="onRelatedServiceClick(relatedService)" class="cursor-pointer">
              <app-service-card [service]="relatedService" [language]="currentLanguage"></app-service-card>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT SIDEBAR -->
      <div class="lg:col-span-1 space-y-6 sticky top-8">
        
        <!-- Order Card -->
        <div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-800 text-center">
          <div class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
            ${{ selectedPackage?.price || service.price }}
          </div>
          <p class="text-gray-600 dark:text-gray-400 mb-6">
            {{ selectedPackage?.name?.[currentLanguage] || 'Basic Package' }}
          </p>
          <button (click)="orderService()" class="w-full py-3 mb-4 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-medium">
            {{ labels.order_now }} (${{ selectedPackage?.price || service.price }})
          </button>
          <button (click)="toggleContactForm()" class="w-full py-3 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
            {{ labels.contact_seller }}
          </button>

          <!-- Contact Form -->
          <div *ngIf="showContactForm" class="mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
            <textarea [(ngModel)]="contactMessage"
              [placeholder]="labels.message_placeholder"
              rows="4"
              class="w-full p-3 rounded-lg border dark:border-gray-600 dark:bg-gray-800 dark:text-white resize-none focus:ring-2 focus:ring-blue-500"></textarea>
            <div class="flex gap-2 mt-3">
              <button (click)="sendMessage()" class="flex-1 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-sm">
                {{ labels.send }}
              </button>
              <button (click)="toggleContactForm()" class="flex-1 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 text-sm">
                {{ labels.cancel }}
              </button>
            </div>
          </div>
        </div>

        <!-- Seller Info Card -->
        <div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-800">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">{{ labels.seller_info }}</h3>
          <div class="flex items-center gap-3 mb-4">
            <img [src]="service.sellerInfo.avatar" class="w-16 h-16 rounded-full border-2 dark:border-gray-600" />
            <div>
              <h4 class="font-medium text-gray-900 dark:text-white">{{ service.sellerInfo.name }}</h4>
              <p class="text-sm text-gray-600 dark:text-gray-400">{{ service.sellerInfo.username }}</p>
              <div class="flex items-center gap-1 mt-1">
                <div class="flex">
                  <ng-container *ngFor="let star of getStarArray(); let i = index">
                    <i class="fas fa-star text-xs text-yellow-400" *ngIf="isStarFilled(i, service.sellerInfo.rating)"></i>
                    <i class="far fa-star text-xs text-gray-300" *ngIf="!isStarFilled(i, service.sellerInfo.rating)"></i>
                  </ng-container>
                </div>
                <span class="text-xs text-gray-600 dark:text-gray-400">{{ service.sellerInfo.rating }}</span>
              </div>
            </div>
          </div>

          <!-- Seller Stats -->
          <div class="space-y-3 text-sm">
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">{{ labels.response_time }}:</span><span class="text-gray-900 dark:text-white">{{ service.sellerInfo.responseTime }}</span></div>
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">{{ labels.completed_orders }}:</span><span class="text-gray-900 dark:text-white">{{ service.sellerInfo.completedOrders }}</span></div>
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">{{ labels.from }}:</span><span class="text-gray-900 dark:text-white">{{ service.sellerInfo.location }}</span></div>
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">{{ labels.member_since }}:</span><span class="text-gray-900 dark:text-white">{{ service.sellerInfo.joinDate | date:'MMM yyyy' }}</span></div>
          </div>

          <!-- Seller Skills -->
          <p class="mt-4 text-sm text-gray-700 dark:text-gray-300">{{ service.sellerInfo.description[currentLanguage] }}</p>
          <div *ngIf="service.sellerInfo.skills.length" class="mt-4">
            <h5 class="text-sm font-medium text-gray-900 dark:text-white mb-2">{{ labels.skills }}</h5>
            <div class="flex flex-wrap gap-2">
              <span *ngFor="let skill of service.sellerInfo.skills" class="px-2 py-1 text-xs rounded bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">{{ skill }}</span>
            </div>
          </div>
                    <div *ngIf="service.sellerInfo.languages.length" class="mt-4">
            <h5 class="text-sm font-medium text-gray-900 dark:text-white mb-2">{{ labels.languages }}</h5>
            <div class="text-sm text-gray-700 dark:text-gray-300">
              {{ service.sellerInfo.languages.join(', ') }}
            </div>
          </div>

          <!-- View Profile Button -->
          <button 
            (click)="goToSellerProfile()"
            class="mt-4 w-full py-2 rounded-lg border border-blue-600 text-blue-600 font-medium hover:bg-blue-50 dark:border-blue-400 dark:text-blue-400 dark:hover:bg-blue-900/20 transition">
            {{ labels.view_profile }}
          </button>
        </div>
      </div> <!-- End Sidebar -->

    </div> <!-- End Main Grid -->
  </div> <!-- End Main Content -->
</div>

