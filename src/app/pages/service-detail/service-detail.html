<div class="min-h-screen bg-gray-50 dark:bg-gray-900" [attr.dir]="languageService.currentLanguage()">

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="flex items-center justify-center min-h-screen">
    <div class="w-12 h-12 border-b-2 border-blue-600 rounded-full animate-spin"></div>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading && service" class="pb-8">


    <div class="px-4 py-8 mx-auto max-w-7xl sm:px-6 lg:px-8 grid gap-8 lg:grid-cols-3">

      <!-- LEFT MAIN CONTENT -->
      <div class="space-y-8 lg:col-span-2">

        <!-- Service Header -->
        <div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-800 flex flex-col md:flex-row gap-6">

          <!-- Image Gallery -->
          <div class="md:w-1/2">
            <div class="relative overflow-hidden rounded-lg aspect-square">
              <img [src]="service.gallery[activeGalleryImage]" [alt]="service.title" class="object-cover w-full h-full" />
              <!-- Gallery Bullets -->
              <div class="absolute flex gap-2 -translate-x-1/2 bottom-4 left-1/2">
                <button
                  *ngFor="let img of service.gallery; let i = index"
                  (click)="selectGalleryImage(i)"
                  class="w-3 h-3 rounded-full transition"
                  [class.bg-white]="i === activeGalleryImage"
                  [class.bg-gray-400]="i !== activeGalleryImage">
                </button>
              </div>
            </div>
            <!-- Thumbnails -->
            <div class="flex gap-2 mt-4 overflow-x-auto">
              <button
                *ngFor="let img of service.gallery; let i = index"
                (click)="selectGalleryImage(i)"
                class="flex-shrink-0 w-16 h-16 rounded-lg overflow-hidden border-2 transition"
                [class.border-blue-500]="i === activeGalleryImage"
                [class.border-gray-200]="i !== activeGalleryImage"
                [class.dark:border-gray-600]="i !== activeGalleryImage">
                <img [src]="img" class="object-cover w-full h-full">
              </button>
            </div>
          </div>

          <!-- Service Info -->
          <div class="md:w-1/2 flex flex-col justify-between">
            <div>
              <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-4">
                {{ service.title }}
              </h1>

              <!-- Rating -->
              <div class="flex items-center gap-3 mb-4">
                <div class="flex">
                  <ng-container *ngFor="let star of getStarArray(); let i = index">
                    <i class="fas fa-star text-yellow-400 text-sm" *ngIf="isStarFilled(i, service.rating)"></i>
                    <i class="fas fa-star-half-alt text-yellow-400 text-sm" *ngIf="isStarHalf(i, service.rating)"></i>
                    <i class="far fa-star text-gray-300 text-sm" *ngIf="!isStarFilled(i, service.rating) && !isStarHalf(i, service.rating)"></i>
                  </ng-container>
                </div>
                <span class="font-semibold text-gray-900 dark:text-white">{{ service.rating.toFixed(1) }}</span>
                <span class="text-gray-600 dark:text-gray-400">({{ reviews.length }} reviews)</span>
              </div>

              <!-- Seller Quick Info -->
              <div class="flex items-center gap-3 p-4 rounded-lg bg-gray-50 dark:bg-gray-700 mb-6">
                <div class="w-12 h-12 rounded-full relative border-2 border-white dark:border-gray-600" >
                  <i class="fa-solid fa-user-tie absolute top-[50%] left-[50%] text-2xl translate-x-[-50%] translate-y-[-50%] text-black dark:text-white"></i>
                </div>
                <div class="flex-1">
                  <!-- hna ya hammaddddddddddddddddddddddddddd -->
                  <button (click)="goToSellerProfile()" class="font-medium text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400">
                    {{ service.sellerInfo.name }}
                  </button>
                  <div class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400">
                    <span *ngIf="service.sellerInfo.isVerified" class="text-green-600 dark:text-green-400">
                      <i class="fas fa-check-circle"></i> {{ labels.verified }}
                    </span>
                  
                  </div>
                </div>
              </div>

              <!-- Key Info -->
              <div class="space-y-2 text-sm">
                <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400">
                  <i class="fas fa-dollar-sign text-blue-500"></i>
                  <span>{{ labels.starting_at }} ${{ selectedPackage?.price || service.price }}</span>
                </div>
                <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400">
                  <i class="fas fa-clock text-blue-500"></i>
                  <span>{{ labels.delivery_time }}: {{ selectedPackage?.deliveryTime || service.deliveryTime }}</span>
                </div>
                
              </div>
            </div>
          </div>
        </div>

        <!-- About Service -->
        <div id="about-service" class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-800 **service-description-card**">
          <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">{{ labels.about_service }}</h2>
          <p class="text-gray-700 dark:text-gray-300">{{ service.fullDescription }}</p>
        </div>

        <!-- Seller Products -->
         <div *ngIf="displayedSellerProducts.length > 0">
          <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-4">{{ labels.Service_products }}</h2>
          <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
            <app-product-card *ngFor="let product of displayedSellerProducts"
              [product]="product"
              [language]="currentLanguage"
              (addToCart)="onAddToCart($event)"
              (addToWishlist)="onAddToWishlist($event)">
            </app-product-card>
          </div>
        </div> 

        <!-- FAQ -->
        <div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-800" *ngIf="service.faq.length">
          <h2 class="text-xl font-bold mb-6 text-gray-900 dark:text-white">{{ labels.faq }}</h2>
          <div class="space-y-4">
            <div *ngFor="let faq of service.faq" class="border rounded-lg dark:border-gray-600">
              <button
                (click)="toggleFAQ(faq.id)"
                class="flex justify-between items-center w-full px-6 py-4 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                <span class="font-medium text-gray-900 dark:text-white">{{ faq.question[currentLanguage] }}</span>
                <i class="fas fa-chevron-down transition-transform" [class.rotate-180]="expandedFAQ === faq.id"></i>
              </button>
              <div *ngIf="expandedFAQ === faq.id" class="px-6 pb-4 text-gray-700 dark:text-gray-300">
                {{ faq.answer[currentLanguage] }}
              </div>
            </div>
          </div>
        </div>
       <!-- Reviews -->
<div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-800">
  <h2 class="text-xl font-bold mb-6 text-gray-900 dark:text-white">
    {{ labels.reviews }} ({{ reviews.length }})
  </h2>
  <div class="space-y-6">
    <app-review-item
      *ngFor="let review of reviews"
      [review]="review"
    ></app-review-item>
  </div>
</div>


        <!-- Related Services -->
        <div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-800" *ngIf="relatedServices.length">
          <h2 class="text-xl font-bold mb-6 text-gray-900 dark:text-white">{{ labels.related_services }}</h2>
          <div class="grid md:grid-cols-2 gap-6">
            <div *ngFor="let relatedService of relatedServices" (click)="onRelatedServiceClick(relatedService)" class="cursor-pointer">
              <app-service-card [service]="relatedService" [language]="currentLanguage"></app-service-card>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT SIDEBAR -->
      <div class="lg:col-span-1 space-y-6 sticky top-8">
        
      <!-- Order Card -->
        <div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-800 text-center">
          <div class="text-3xl font-bold text-gray-900 dark:text-white mb-2">
            ${{ selectedPackage?.price || service.price }}
          </div>
          <p class="text-gray-600 dark:text-gray-400 mb-6">
            {{ selectedPackage?.name?.[currentLanguage] || 'Basic Package' }}
          </p>
          @if(auth.loggedIn.value) {
          <button routerLink="/chat/{{service.sellerInfo.id}}" class="w-full py-3 mb-4 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition">
            {{ labels.contact_seller }}
          </button>
          <button (click)="showRequestForm = true" class="w-full py-3 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-medium">
            {{ labels.order_now }}
          </button>
        }
      <!-- Request Form -->
      <div *ngIf="showRequestForm" class="mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 text-left">
            {{ labels.description }}
          </label>
          <textarea [(ngModel)]="requestDescription"
            [placeholder]="labels.description_placeholder"
            rows="4"
            class="w-full p-3 rounded-lg border dark:border-gray-600 dark:bg-gray-800 dark:text-white resize-none focus:ring-2 focus:ring-blue-500">
          </textarea>
        </div>
        
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 text-left">
            {{ labels.reference_image }}
          </label>
          <input type="file" (change)="onFileSelected($event)" accept="image/*" class="hidden" #fileInput>
          <div class="flex flex-col gap-2">
            <button (click)="fileInput.click()" class="w-full py-2 px-4 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 text-sm">
              {{ labels.choose_file }}
            </button>
            <div *ngIf="selectedFile" class="mt-2">
              <img [src]="imagePreview" class="max-h-40 rounded-lg border border-gray-200 dark:border-gray-600">
              <button (click)="removeImage()" class="mt-2 text-red-600 dark:text-red-400 text-sm">
                {{ labels.remove_image }}
              </button>
            </div>
          </div>
        </div>

       <div class="flex gap-2 mt-3">
  <button (click)="createRequest()" [disabled]="!requestDescription || isSubmitting" class="flex-1 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-sm disabled:opacity-50 flex items-center justify-center">
    <span *ngIf="!isSubmitting">{{ labels.submit_request }}</span>
    <span *ngIf="isSubmitting" class="flex items-center">
      <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      {{ labels.processing }}
    </span>
  </button>
  <button (click)="toggleRequestForm()" [disabled]="isSubmitting" class="flex-1 py-2 rounded-lg border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 text-sm">
    {{ labels.cancel }}
  </button>
</div>
      </div>
    </div>
        <!-- Seller Info Card -->
        <div class="p-6 bg-white rounded-lg shadow-sm dark:bg-gray-800">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">{{ labels.seller_info }}</h3>
          <div class="flex items-center gap-3 mb-4">
            <div class="w-16 h-16 rounded-full relative border-2 dark:border-gray-600" >
              <i class="fa-solid fa-user-tie absolute top-[50%] left-[50%] text-3xl translate-x-[-50%] translate-y-[-50%] text-black dark:text-white"></i>
            </div>
            <div>
              <h4 class="font-medium text-gray-900 dark:text-white">{{ service.sellerInfo.name }}</h4>
              <p class="text-sm text-gray-600 dark:text-gray-400">{{ service.sellerInfo.username }}</p>
              <div class="flex items-center gap-1 mt-1">
              </div>
            </div>
          </div>

          <!-- Seller Stats -->
          <div class="space-y-3 text-sm">
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">{{ labels.response_time }}:</span><span class="text-gray-900 dark:text-white">{{ service.sellerInfo.responseTime }}</span></div>
            <div class="flex justify-between"><span class="text-gray-600 dark:text-gray-400">{{ labels.completed_orders }}:</span><span class="text-gray-900 dark:text-white">{{ service.sellerInfo.completedOrders }}</span></div>
          </div>

          <!-- Seller Skills -->
          <p class="mt-4 text-sm text-gray-700 dark:text-gray-300">{{ service.sellerInfo.description[currentLanguage] }}</p>
          <div *ngIf="service.sellerInfo.skills.length" class="mt-4">
            <h5 class="text-sm font-medium text-gray-900 dark:text-white mb-2">{{ labels.skills }}</h5>
            <div class="flex flex-wrap gap-2">
              <span *ngFor="let skill of service.sellerInfo.skills" class="px-2 py-1 text-xs rounded bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200">{{ skill }}</span>
            </div>
          </div>
                    <div *ngIf="service.sellerInfo.languages.length" class="mt-4">
            <h5 class="text-sm font-medium text-gray-900 dark:text-white mb-2">{{ labels.languages }}</h5>
            <div class="text-sm text-gray-700 dark:text-gray-300">
              {{ service.sellerInfo.languages.join(', ') }}
            </div>
          </div>

          <!-- View Profile Button -->
          <button
            (click)="goToSellerProfile()"
            class="mt-4 w-full py-2 rounded-lg border border-blue-600 text-blue-600 font-medium hover:bg-blue-50 dark:border-blue-400 dark:text-blue-400 dark:hover:bg-blue-900/20 transition">
            {{ labels.view_profile }}
          </button>
        </div>
      </div> <!-- End Sidebar -->

    </div> <!-- End Main Grid -->
  </div> <!-- End Main Content -->
</div>

