<div class="min-h-screen bg-gray-50 dark:bg-gray-900">
  <!-- Breadcrumb -->
  <div class="px-4 py-3 mx-auto max-w-7xl sm:px-6 lg:px-8">
    <nav class="flex mb-6 text-sm text-gray-500 dark:text-gray-400" aria-label="Breadcrumb">
      <ol class="flex items-center space-x-2 rtl:space-x-reverse">
        <li>
          <a routerLink="/" class="transition-colors hover:text-blue-600 dark:hover:text-blue-400">
            {{ labels.home }}
          </a>
        </li>
        <li class="flex items-center">
          <i class="mx-2 text-gray-400 fas fa-chevron-right"></i>
          <a routerLink="/products" class="transition-colors hover:text-blue-600 dark:hover:text-blue-400">
            {{ labels.products }}
          </a>
        </li>
        <li class="flex items-center">
          <i class="mx-2 text-gray-400 fas fa-chevron-right"></i>
          <span class="text-gray-900 dark:text-white">{{ product?.title }}</span>
        </li>
      </ol>
    </nav>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex items-center justify-center min-h-96">
    <div class="text-center">
      <div class="w-16 h-16 mx-auto mb-4 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
      <p class="text-gray-600 dark:text-gray-400">{{ labels.loading }}</p>
    </div>
  </div>

  <!-- Product Details -->
  <div *ngIf="!loading && product" class="px-4 mx-auto max-w-7xl sm:px-6 lg:px-8">
    <div class="grid gap-8 lg:grid-cols-2">
      <!-- Product Images -->
      <div class="space-y-4">
        <!-- Main Image -->
        <div class="relative overflow-hidden bg-white border border-gray-200 rounded-lg dark:bg-gray-800 dark:border-gray-700">
          <img
            [src]="selectedImage || product.imageUrl"
            [alt]="product.title"
            class="object-cover w-full h-96 transition-transform duration-300 hover:scale-105"
          />

          <!-- Image Overlay Actions -->
          <div class="absolute top-4 right-4 flex flex-col space-y-2">
            <button
              (click)="onAddToWishlist()"
              class="p-3 text-gray-700 transition-colors rounded-full bg-white/90 hover:bg-white dark:bg-gray-800/90 dark:text-gray-300 dark:hover:bg-gray-800"
              [attr.aria-label]="labels.add_to_wishlist">
              <i class="text-lg fas fa-heart" [class.text-red-500]="isInWishlist"></i>
            </button>
            <button
              (click)="onShare()"
              class="p-3 text-gray-700 transition-colors rounded-full bg-white/90 hover:bg-white dark:bg-gray-800/90 dark:text-gray-300 dark:hover:bg-gray-800"
              [attr.aria-label]="labels.share">
              <i class="text-lg fas fa-share-alt"></i>
            </button>
          </div>

          <!-- Custom Badge -->
          <!-- <div *ngIf="product.customizable" class="absolute top-4 left-4">
            <span class="flex items-center gap-1 px-3 py-1 text-sm text-white bg-blue-600 rounded-full animate-pulse">
              <i class="text-sm fas fa-pencil-alt"></i>
              <span>{{ labels.customizable }}</span>
            </span>
          </div>
        </div> -->

        <!-- Thumbnail Images -->
        <div class="grid grid-cols-4 gap-2">
          <button
            *ngFor="let image of productImages; let i = index"
            (click)="selectImage(image)"
            [class.ring-2]="selectedImage === image"
            [class.ring-blue-500]="selectedImage === image"
            class="overflow-hidden transition-all border border-gray-200 rounded-lg dark:border-gray-700 hover:border-blue-500">
            <img
              [src]="image"
              [alt]="product.title + ' - ' + (i + 1)"
              class="object-cover w-full h-20 transition-transform hover:scale-110"
            />
          </button>
        </div>
      </div>

      <!-- Product Info -->
      <div class="space-y-6">
        <!-- Title and Rating -->
        <div>
          <h1 class="text-3xl font-bold text-gray-900 dark:text-white">{{ product.title }}</h1>
          <div class="flex items-center gap-4 mt-2">
            <div class="flex items-center gap-2">
              <!-- <div class="flex items-center star-rating">
                <ng-container *ngFor="let star of getStarArray(); let i = index">
                  <i class="text-lg text-yellow-400 fas fa-star star"
                     *ngIf="isStarFilled(i)"></i>
                  <i class="text-lg text-gray-300 far fa-star dark:text-gray-600 star"
                     *ngIf="!isStarFilled(i)"></i>
                </ng-container>
              </div> -->
              <!-- <span class="font-medium text-gray-900 dark:text-white">{{ product.rating }}</span> -->
            </div>
            <span class="text-gray-500 dark:text-gray-400">•</span>
            <button
              (click)="onSellerClick()"
              class="text-blue-600 transition-colors hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 hover:underline">
              {{ product.sellerId }}
            </button>
            <span class="text-gray-500 dark:text-gray-400">•</span>
            <span class="text-sm text-gray-600 dark:text-gray-400">{{ labels.in_stock }}</span>
          </div>
        </div>

        <!-- Price -->
        <div class="p-4 bg-gray-50 rounded-lg dark:bg-gray-800">
          <div class="flex items-baseline gap-2">
            <span class="text-3xl font-bold text-gray-900 dark:text-white">${{ product.price }}</span>
            <span *ngIf="product.originalPrice" class="text-lg text-gray-500 line-through dark:text-gray-400">
              ${{ product.originalPrice }}
            </span>
            <span *ngIf="product.originalPrice" class="px-2 py-1 text-sm text-white bg-red-500 rounded-full">
              {{ getDiscountPercentage() }}% {{ labels.off }}
            </span>
          </div>
          <!-- <p *ngIf="product.customizable" class="mt-2 text-sm text-gray-600 dark:text-gray-400">
            {{ labels.starting_price }}
          </p> -->
        </div>

        <!-- Description -->
        <div>
          <h3 class="mb-2 text-lg font-semibold text-gray-900 dark:text-white">{{ labels.description }}</h3>
          <p class="text-gray-700 leading-relaxed dark:text-gray-300">{{ product.description }}</p>
        </div>

        <!-- Product Details -->
        <div class="grid gap-4 sm:grid-cols-2">
          <div>
            <h4 class="mb-2 font-medium text-gray-900 dark:text-white">{{ labels.category }}</h4>
            <p class="text-gray-600 dark:text-gray-400">{{ product.category }}</p>
          </div>
          <div>
            <h4 class="mb-2 font-medium text-gray-900 dark:text-white">{{ labels.material }}</h4>
            <p class="text-gray-600 dark:text-gray-400">{{ product.material || labels.not_specified }}</p>
          </div>
          <div>
            <h4 class="mb-2 font-medium text-gray-900 dark:text-white">{{ labels.dimensions }}</h4>
            <p class="text-gray-600 dark:text-gray-400">{{ product.dimensions || labels.not_specified }}</p>
          </div>
          <div>
            <h4 class="mb-2 font-medium text-gray-900 dark:text-white">{{ labels.weight }}</h4>
            <p class="text-gray-600 dark:text-gray-400">{{ product.weight || labels.not_specified }}</p>
          </div>
        </div>

        <!-- Quantity and Add to Cart -->
        <div class="space-y-4">
          <div class="flex items-center gap-4">
            <label class="font-medium text-gray-900 dark:text-white">{{ labels.quantity }}:</label>
            <div class="flex items-center border border-gray-300 rounded-md dark:border-gray-600">
              <button
                (click)="decreaseQuantity()"
                class="px-3 py-2 text-gray-600 transition-colors hover:text-gray-900 dark:text-gray-400 dark:hover:text-white">
                <i class="fas fa-minus"></i>
              </button>
              <input
                type="number"
                [(ngModel)]="quantity"
                min="1"
                class="w-16 px-2 py-2 text-center border-0 focus:ring-0 dark:bg-gray-800 dark:text-white"
              />
              <button
                (click)="increaseQuantity()"
                class="px-3 py-2 text-gray-600 transition-colors hover:text-gray-900 dark:text-gray-400 dark:hover:text-white">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>

          <div class="flex gap-4">
            <app-form-button
              (click)="onAddToCart()"
              [loading]="addingToCart"
              class="flex-1"
              [text]="labels.add_to_cart"
              [icon]="'fas fa-cart-plus'">
            </app-form-button>

            <app-form-button
              (click)="onBuyNow()"
              [loading]="buyingNow"
              class="flex-1"
              [text]="labels.buy_now"
              [icon]="'fas fa-bolt'"
              [variant]="'secondary'">
            </app-form-button>
          </div>
        </div>

        <!-- Shipping Info -->
        <div class="p-4 bg-blue-50 rounded-lg dark:bg-blue-900/20">
          <div class="flex items-start gap-3">
            <i class="text-blue-600 fas fa-shipping-fast mt-1"></i>
            <div>
              <h4 class="font-medium text-blue-900 dark:text-blue-100">{{ labels.free_shipping }}</h4>
              <p class="text-sm text-blue-700 dark:text-blue-200">{{ labels.shipping_info }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Reviews Section -->
    <div class="mt-16">
      <div class="flex items-center justify-between mb-8">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{{ labels.reviews }}</h2>
        <button
          (click)="showReviewForm = true"
          class="px-4 py-2 text-sm font-medium text-white transition-colors bg-blue-600 rounded-md hover:bg-blue-700">
          {{ labels.write_review }}
        </button>
      </div>

      <!-- Review Stats -->
      <div class="grid gap-6 mb-8 lg:grid-cols-3">
        <div class="p-6 bg-white border border-gray-200 rounded-lg dark:bg-gray-800 dark:border-gray-700">
          <div class="text-center">
            <div class="text-3xl font-bold text-gray-900 dark:text-white">{{ averageRating }}</div>
            <div class="flex justify-center mt-2">
              <!-- <div class="flex items-center star-rating">
                <ng-container *ngFor="let star of getStarArray(); let i = index">
                  <i class="text-lg text-yellow-400 fas fa-star star"
                     *ngIf="isStarFilled(i, averageRating)"></i>
                  <i class="text-lg text-gray-300 far fa-star dark:text-gray-600 star"
                     *ngIf="!isStarFilled(i, averageRating)"></i>
                </ng-container>
              </div> -->
            </div>
            <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">{{ totalReviews }} {{ labels.reviews }}</p>
          </div>
        </div>

        <div class="p-6 bg-white border border-gray-200 rounded-lg dark:bg-gray-800 dark:border-gray-700">
          <h4 class="mb-4 font-medium text-gray-900 dark:text-white">{{ labels.rating_distribution }}</h4>
          <div class="space-y-2">
            <div *ngFor="let rating of ratingDistribution; let i = index" class="flex items-center gap-2">
              <span class="text-sm text-gray-600 dark:text-gray-400">{{ 5 - i }} {{ labels.stars }}</span>
              <div class="flex-1 h-2 bg-gray-200 rounded-full dark:bg-gray-700">
                <div
                  class="h-2 bg-yellow-400 rounded-full transition-all duration-300"
                  [style.width.%]="rating.percentage">
                </div>
              </div>
              <span class="text-sm text-gray-600 dark:text-gray-400">{{ rating.count }}</span>
            </div>
          </div>
        </div>

        <div class="p-6 bg-white border border-gray-200 rounded-lg dark:bg-gray-800 dark:border-gray-700">
          <h4 class="mb-4 font-medium text-gray-900 dark:text-white">{{ labels.review_filters }}</h4>
          <div class="space-y-2">
            <button
              *ngFor="let filter of reviewFilters"
              (click)="filterReviews(filter.value)"
              [class.bg-blue-100]="selectedFilter === filter.value"
              [class.text-blue-800]="selectedFilter === filter.value"
              class="w-full px-3 py-2 text-left text-sm transition-colors rounded-md hover:bg-gray-100 dark:hover:bg-gray-700">
              {{ filter.label }} ({{ filter.count }})
            </button>
          </div>
        </div>
      </div>

      <!-- Reviews List -->
      <div class="space-y-6">
        <app-review-item
          *ngFor="let review of filteredReviews"
          [review]="review"
          [language]="language">
        </app-review-item>
      </div>

      <!-- Load More Reviews -->
      <div *ngIf="hasMoreReviews" class="mt-8 text-center">
        <app-form-button
          (click)="loadMoreReviews()"
          [loading]="loadingReviews"
          [text]="labels.load_more_reviews"
          [icon]="'fas fa-chevron-down'">
        </app-form-button>
      </div>
    </div>

    <!-- Related Products -->
    <div class="mt-16">
      <h2 class="mb-8 text-2xl font-bold text-gray-900 dark:text-white">{{ labels.related_products }}</h2>
      <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
        <app-product-card
          *ngFor="let relatedProduct of relatedProducts"
          [product]="relatedProduct"
          [language]="language"
          (addToCart)="onAddToCart()"
          (addToWishlist)="onAddToWishlist()">
        </app-product-card>
      </div>
    </div>
  </div>

  <!-- Review Form Modal -->
  <div *ngIf="showReviewForm" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50">
    <div class="w-full max-w-md p-6 mx-4 bg-white rounded-lg shadow-xl dark:bg-gray-800">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white">{{ labels.write_review }}</h3>
        <button
          (click)="showReviewForm = false"
          class="text-gray-400 transition-colors hover:text-gray-600 dark:hover:text-gray-300">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form (ngSubmit)="submitReview()" class="space-y-4">
        <div>
          <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">{{ labels.rating }}</label>
          <div class="flex items-center gap-2">
            <ng-container *ngFor="let star of getStarArray(); let i = index">
              <button
                type="button"
                (click)="setReviewRating(i + 1)"
                class="text-2xl transition-colors"
                [class.text-yellow-400]="reviewRating > i"
                [class.text-gray-300]="reviewRating <= i">
                <i class="fas fa-star"></i>
              </button>
            </ng-container>
          </div>
        </div>

        <div>
          <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">{{ labels.comment }}</label>
          <textarea
            [(ngModel)]="reviewComment"
            name="comment"
            rows="4"
            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
            [placeholder]="labels.review_placeholder">
          </textarea>
        </div>

        <div class="flex gap-3">
          <app-form-button
            type="button"
            (click)="showReviewForm = false"
            [text]="labels.cancel"
            [variant]="'secondary'">
          </app-form-button>

          <app-form-button
            type="submit"
            [loading]="submittingReview"
            [text]="labels.submit_review"
            [icon]="'fas fa-paper-plane'">
          </app-form-button>
        </div>
      </form>
    </div>
  </div>
</div>
