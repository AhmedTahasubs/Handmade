<div class="space-y-6">
  <!-- Page Header -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div>
      <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
        {{ getTranslation('title') }}
      </h1>
      <p class="text-gray-600 dark:text-gray-400">
        {{ getTranslation('subtitle') }}
      </p>
    </div>
    <button
      (click)="openCreateModal()"
      class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 gap-2"
    >
      <i class="fa-solid fa-plus w-4 h-4"></i>
      {{ getTranslation('addCategory') }}
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex justify-center items-center p-8">
    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
  </div>
  <!-- Stats Card -->
  <div *ngIf="!isLoading" class="bg-white dark:bg-gray-800 rounded-xl p-6 !mb-5 border border-gray-200 dark:border-gray-700">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-sm text-gray-600 dark:text-gray-400">{{ getTranslation('totalCategories') }}</p>
        <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ getTotalCategories() }}</p>
      </div>
      <div class="p-3 bg-blue-100 dark:bg-blue-900/50 rounded-lg">
        <i class="fa-solid fa-tags w-6 h-6 text-blue-600 dark:text-blue-400"></i>
      </div>
    </div>
  </div>

  <!-- Categories Table -->
  <app-data-table
    *ngIf="!isLoading"
    [data]="categories"
    [columns]="tableColumns"
    [actions]="tableActions"
    (actionClicked)="onTableAction($event)"
  ></app-data-table>

  <!-- Create/Edit Modal -->
<app-modal
  [isOpen]="showModal"
  [title]="modalTitle"
  [confirmText]="getConfirmButtonText('save')"
  [cancelText]="getTranslation('cancel')"
  confirmButtonType="primary"
  (closed)="!isProcessing && closeModal()"
  (confirmed)="saveCategory()"
>
  <div *ngIf="isProcessing" class="absolute inset-0 bg-white/50 dark:bg-gray-800/50 flex items-center justify-center z-10">
    <div class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"></div>
  </div>
  
  <form [formGroup]="categoryForm" class="space-y-6">
    <!-- Category Name -->
    <div>
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
        {{ getTranslation('categoryName') }}
      </label>
      <input
        type="text"
        formControlName="name"
        class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
        [placeholder]="getTranslation('categoryName')"
        [class.border-red-500]="categoryForm.get('name')?.invalid && categoryForm.get('name')?.touched"
      />
      <div *ngIf="categoryForm.get('name')?.invalid && categoryForm.get('name')?.touched" class="mt-1 text-sm text-red-600 dark:text-red-400">
        <span *ngIf="categoryForm.get('name')?.errors?.['required']">
          {{ getTranslation('validation.required') }}
        </span>
        <span *ngIf="categoryForm.get('name')?.errors?.['minlength']">
          {{ getTranslation('validation.minLength') }}
        </span>
      </div>
    </div>

    <!-- Image Upload -->
    <div>
      <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
        {{ getTranslation('image') }}
      </label>

      <!-- Image Preview -->
      <div class="mb-4" *ngIf="currentImage">
        <img 
          [src]="currentImage" 
          alt="Category preview"
          class="h-32 w-32 object-cover rounded-lg"
        >
      </div>

      <!-- File Input -->
      <div class="flex flex-col sm:flex-row items-start sm:items-center gap-4">
        <label for="fileInput" class="cursor-pointer">
          <span class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 flex items-center gap-2">
            <i class="fas fa-upload w-4 h-4" aria-hidden="true"></i>
            {{ currentImage ? 'Change Image' : 'Upload Image' }}
          </span>
          <input 
            type="file" 
            id="fileInput"
            (change)="onFileSelected($event)"
            accept="image/*"
            class="hidden"
          >
        </label>

        <button 
          type="button" 
          *ngIf="currentImage"
          (click)="resetFileInput()"
          class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors duration-200 flex items-center gap-2"
        >
          <i class="fas fa-trash w-4 h-4" aria-hidden="true"></i>
          Remove
        </button>
      </div>

      <div *ngIf="!isEditMode && !selectedFile && categoryForm.get('file')?.touched" class="mt-1 text-sm text-red-600 dark:text-red-400">
        {{ getTranslation('validation.imageRequired') }}
      </div>
    </div>
  </form>
</app-modal>

<!-- Delete Confirmation Modal -->
<app-modal
  [isOpen]="showDeleteModal"
  [title]="getTranslation('deleteCategory')"
  [confirmText]="getConfirmButtonText('delete')"
  [cancelText]="getTranslation('cancel')"
  confirmButtonType="danger"
  (closed)="!isProcessing && closeDeleteModal()"
  (confirmed)="confirmDelete()"
>
  <div *ngIf="isProcessing" class="absolute inset-0 bg-white/50 dark:bg-gray-800/50 flex items-center justify-center z-10">
    <div class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-red-500"></div>
  </div>
  
  <div class="text-center">
    <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 dark:bg-red-900/50 mb-4">
      <i class="fa-solid fa-trash w-6 h-6 text-red-600 dark:text-red-400"></i>
    </div>
    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">
      {{ getTranslation('deleteConfirm') }}
    </h3>
    <p class="text-sm text-gray-500 dark:text-gray-400">
      {{ getTranslation('deleteMessage') }}
    </p>
    <div *ngIf="categoryToDelete" class="mt-4 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
      <p class="font-medium text-gray-900 dark:text-white">{{ categoryToDelete.name }}</p>
    </div>
  </div>
</app-modal>

  <!-- View Details Modal -->
  <app-modal
    [isOpen]="showViewModal"
    [title]="getTranslation('categoryDetails')"
    [showConfirmButton]="false"
    [cancelText]="getTranslation('close')"
    (closed)="closeViewModal()"
  >
    <div *ngIf="selectedCategory" class="space-y-6">
      <!-- Category Image -->
      <div *ngIf="selectedCategory.imageUrl" class="text-center">
        <img [src]="selectedCategory.imageUrl" [alt]="selectedCategory.name" class="w-32 h-32 object-cover rounded-lg mx-auto">
      </div>

      <!-- Category Info -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-500 dark:text-gray-400">{{ getTranslation('name') }}</label>
          <p class="text-gray-900 dark:text-white font-medium">{{ selectedCategory.name }}</p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-500 dark:text-gray-400">ID</label>
          <p class="text-gray-900 dark:text-white">{{ selectedCategory.id }}</p>
        </div>
      </div>
    </div>
  </app-modal>
</div>