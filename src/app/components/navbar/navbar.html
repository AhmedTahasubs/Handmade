<!-- Navbar -->
<div class="sticky top-0 z-50 border-b border-gray-200 bg-white/80 dark:bg-gray-900/80 backdrop-blur dark:border-gray-700">
  <nav class="px-4 mx-auto max-w-7xl sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      
      <!-- Logo -->
      <a [routerLink]="'/'" class="flex items-center space-x-2 transition-opacity hover:opacity-80">
        <div class="flex items-center justify-center w-8 h-8 bg-blue-600 rounded-lg ms-2">
          <span class="text-sm font-bold text-white">HM</span>
        </div>
        <span class="text-xl font-bold text-gray-900 dark:text-white">
          {{ language === 'en' ? 'HandMade' : 'صُنع يدوياً' }}
        </span>
      </a>

      <!-- Desktop Navigation -->
      <div class="items-center hidden space-x-8 md:flex">
        <a 
          *ngFor="let item of navItems[language]" 
          [routerLink]="item.route"
          routerLinkActive="text-blue-600 dark:text-blue-400"
          [routerLinkActiveOptions]="{ exact: item.route === '/' }"
          class="font-medium text-gray-700 transition-colors dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400"
        >
          {{ item.label }}
        </a>
      </div>

      <!-- Right Side -->
      <div class="flex items-center space-x-4 dark:text-gray-300 ">

        <!-- Theme Toggle -->
        <button
          (click)="toggleTheme()"
          class="p-2 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"
          aria-label="Toggle theme"
        >
          <i 
            [ngClass]="theme === 'dark' ? 'fa-solid fa-sun text-blue-400' : 'fa-solid fa-moon text-blue-500'" 
            class="text-lg transition-transform duration-200 hover:rotate-45"
          ></i>
        </button>

        <!-- Language Toggle -->
        <button
          (click)="toggleLanguage()"
          class="flex items-center p-2 space-x-1 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"
          aria-label="Toggle language"
        >
          <i class="text-blue-500 fa-solid fa-language"></i>
          <span class="text-sm font-medium">{{ language.toUpperCase() }}</span>
        </button>

        <!-- User Actions -->
        <div class="items-center hidden space-x-3 sm:flex">
          <!-- Wishlist -->
          <button class="relative p-2 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">
            <i class="text-lg text-red-500 fa-regular fa-heart"></i>
            <span class="absolute flex items-center justify-center w-4 h-4 text-xs text-white bg-blue-600 rounded-full -top-1 -right-1">2</span>
          </button>

          <!-- Cart -->
          <button class="relative p-2 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">
            <i class="text-lg fa-solid fa-cart-shopping"></i>
            <span class="absolute flex items-center justify-center w-4 h-4 text-xs text-white bg-blue-600 rounded-full -top-1 -right-1">3</span>
          </button>

          <!-- Auth Buttons -->
          <ng-container *ngIf="isLoggedIn; else guest">
            <!-- Logged in - User Menu -->
            <div class="relative">
              <button 
                #userButton
                (click)="toggleUserMenu()"
                class="p-2 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"
              >
                <i class="text-lg fa-solid fa-user"></i>
              </button>
              
              <!-- User Dropdown Menu -->
              <div 
                #userMenu
                *ngIf="isUserMenuOpen"
                class="absolute right-0 z-50 w-48 mt-2 origin-top-right bg-white rounded-lg shadow-lg dark:bg-gray-800 ring-1 ring-black ring-opacity-5 focus:outline-none"
                [class.rtl]="language === 'ar'"
                [class.right-0]="language === 'en'"
                [class.left-0]="language === 'ar'"
              >
                <div class="py-1">
                  <a 
                    *ngFor="let item of userMenuItems[language]"
                    [routerLink]="item.action ? null : item.route"
                    (click)="handleUserMenuItemClick(item)"
                    class="block px-4 py-2 text-sm text-gray-700 transition-colors rounded-lg hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 cursor-pointer"
                  >
                    <i class="mr-2 fa-solid" [ngClass]="item.icon"></i>
                    {{ item.label }}
                  </a>
                </div>
              </div>
            </div>
          </ng-container>
          <ng-template #guest>
            <!-- Not logged in -->
            <a [routerLink]="'/login'" class="px-3 py-1 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700">@if (this.language=='ar') {سجل الدخول}@else{Login}</a>
            <a [routerLink]="'/register'" class="px-3 py-1 text-sm font-medium text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-100 dark:hover:bg-gray-800">@if (this.language=='ar') {سجل لأول مره}@else{Register}</a>
          </ng-template>
        </div>

        <!-- Mobile Menu Button -->
        <button
          (click)="toggleMenu()"
          class="p-2 transition-colors rounded-lg md:hidden hover:bg-gray-100 dark:hover:bg-gray-800"
        >
          <i 
            [ngClass]="isMenuOpen ? 'fa-solid fa-xmark' : 'fa-solid fa-bars'" 
            class="text-xl"
          ></i>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div *ngIf="isMenuOpen" class="py-4 border-t border-gray-200 md:hidden mobile-menu dark:border-gray-700">
      <div class="space-y-1">
        <a 
          *ngFor="let item of navItems[language]" 
          [routerLink]="item.route"
          routerLinkActive="text-blue-600 dark:text-blue-400"
          [routerLinkActiveOptions]="{ exact: item.route === '/' }"
          class="block py-2 font-medium text-gray-700 transition-colors dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400"
          (click)="closeMenu()"
        >
          {{ item.label }}
        </a>

        <!-- Divider -->
        <div class="my-2 border-t border-gray-200 dark:border-gray-700"></div>

        <!-- User Section -->
        <div class="flex flex-col gap-2">
          <ng-container *ngIf="isLoggedIn; else mobileGuest">
            <!-- Mobile User Menu -->
            <div class="space-y-1">
              <button 
                (click)="toggleUserMenu()"
                class="flex items-center w-full p-2 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"
              >
                <i class="text-lg fa-solid fa-user"></i> 
                <span class="ms-2">{{ language === 'en' ? 'Profile' : 'الملف' }}</span>
                <i class="ms-auto fa-solid" [ngClass]="isUserMenuOpen ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
              </button>
              
              <!-- Mobile User Dropdown -->
              <div *ngIf="isUserMenuOpen" class="pl-4 space-y-1">
                <a 
                  *ngFor="let item of userMenuItems[language]"
                  [routerLink]="item.action ? null : item.route"
                  (click)="handleUserMenuItemClick(item, true)"
                  class="block px-4 py-2 text-sm text-gray-700 transition-colors rounded-lg hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 cursor-pointer"
                >
                  <i class="mr-2 fa-solid" [ngClass]="item.icon"></i>
                  {{ item.label }}
                </a>
              </div>
            </div>
          </ng-container>
          <ng-template #mobileGuest>
            <a [routerLink]="'/login'" class="block w-full px-3 py-2 text-center text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700">@if (this.language=='ar') {سجل الدخول}@else{Login}</a>
            <a [routerLink]="'/register'" class="block w-full px-3 py-2 text-center text-sm font-medium text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-100 dark:hover:bg-gray-800">@if (this.language=='ar') {سجل لأول مره}@else{Register}</a>
          </ng-template>
        </div>
      </div>
    </div>
  </nav>
</div>