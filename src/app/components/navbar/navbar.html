<!-- Navbar -->
<div class="sticky top-0 z-50 border-b border-gray-200 bg-white/80 dark:bg-gray-900/80 backdrop-blur dark:border-gray-700">
  <nav class="px-4 mx-auto max-w-7xl sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      
      <!-- Logo -->
      <a [routerLink]="'/'" class="flex items-center space-x-2 transition-opacity hover:opacity-80">
        <div class="flex items-center justify-center w-8 h-8 bg-blue-600 rounded-lg ms-3">
          <span class="text-sm font-bold text-white">HM</span>
        </div>
        <span class="text-xl font-bold text-gray-900 dark:text-white">
          {{ language === 'en' ? 'HandMade' : 'صُنع يدوياً' }}
        </span>
      </a>

      <!-- Desktop Navigation -->
      <div class="items-center hidden space-x-8 lg:flex">
        <a 
          *ngFor="let item of navItems[language]" 
          [routerLink]="item.route"
          routerLinkActive="text-blue-600 dark:text-blue-400 font-semibold"
          [routerLinkActiveOptions]="{ exact: item.route === '/' }"
          class="font-medium text-gray-700 transition-colors dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400"
        >
          {{ item.label }}
        </a>
      </div>

      <!-- Right Side -->
      <div class="flex items-center space-x-2 dark:text-gray-300">

        <!-- Theme Toggle -->
        <button
          (click)="toggleTheme()"
          class="p-2 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"
          aria-label="Toggle theme"
        >
          <i 
            [ngClass]="theme === 'dark' ? 'fa-solid fa-sun text-blue-500' : 'fa-solid fa-moon text-blue-500'" 
            class="text-lg"
          ></i>
        </button>

        <!-- Language Toggle -->
        <button
          (click)="toggleLanguage()"
          class="flex items-center p-2 space-x-1 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"
          aria-label="Toggle language"
        >
          <i class="text-blue-500 fa-solid fa-language"></i>
          <span class="text-sm font-medium">{{ language.toUpperCase() }}</span>
        </button>

        <!-- User Actions -->
        <div class="items-center hidden  space-x-1 lg:flex">
          <!-- Cart -->
           @if (isLoggedIn) {
             <a routerLink="/cart" class="relative p-2 transition-colors rounded-lg text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-800">
               <i class="text-lg fa-solid fa-cart-shopping text-gray-700 dark:text-gray-300"></i>
                <!-- uncomment the next line if you want to show cart item count  bs lazm yb2a updated and fetched-->
               <!-- <span class="absolute flex items-center justify-center w-5 h-5 text-xs text-white bg-blue-600 rounded-full -top-1 -right-1">3</span> -->
             </a>
           }
          <!-- Auth Buttons -->
          <ng-container *ngIf="isLoggedIn; else guest">
            <!-- Logged in - User Menu -->
            <div class="relative">
              <button 
                #userButton
                (click)="toggleUserMenu()"
                class="flex items-center p-2 space-x-1 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"
              >
                <i class="text-lg fa-solid fa-user"></i>
                <span class="hidden text-sm font-medium lg:inline">{{ language === 'en' ? 'Account' : 'حسابي' }}</span>
              </button>
              
              <!-- User Dropdown Menu -->
              <div 
                #userMenu
                *ngIf="isUserMenuOpen"
                class="absolute right-0 z-50 w-48 mt-2 origin-top-right bg-white rounded-lg shadow-lg dark:bg-gray-800 ring-1 ring-black ring-opacity-5 focus:outline-none"
                [class.rtl]="language === 'ar'"
                [class.right-0]="language === 'en'"
                [class.left-0]="language === 'ar'"
              >
                <div class="py-1">
                  <a 
                    *ngFor="let item of userMenuItems[language]"
                    [routerLink]="item.action ? null : item.route"
                    (click)="handleUserMenuItemClick(item)"
                    class="flex items-center px-4 py-2 text-sm text-gray-700 transition-colors rounded-lg hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 cursor-pointer"
                  >
                    <i class="w-5 fa-solid" [ngClass]="item.icon"></i>
                    <span class="ml-2">{{ item.label }}</span>
                  </a>
                </div>
              </div>
            </div>
          </ng-container>
          <ng-template #guest>
            <!-- Not logged in -->
            <div class="hidden space-x-2 sm:flex">
              <a [routerLink]="'/login'" class="px-3 py-1.5 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors">
                {{ language === 'ar' ? 'سجل الدخول' : 'Login' }}
              </a>
              <a [routerLink]="'/register'" class="px-3 py-1.5 text-sm font-medium text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-800 transition-colors">
                {{ language === 'ar' ? 'سجل لأول مره' : 'Register' }}
              </a>
            </div>
          </ng-template>
        </div>

        <!-- Mobile Menu Button -->
        <button
          (click)="toggleMenu()"
          class="p-2 transition-colors rounded-lg lg:hidden hover:bg-gray-100 dark:hover:bg-gray-800"
          aria-label="Toggle menu"
        >
          <i 
            [ngClass]="isMenuOpen ? 'fa-solid fa-xmark' : 'fa-solid fa-bars'" 
            class="text-xl"
          ></i>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div 
      *ngIf="isMenuOpen" 
      class="py-4 border-t border-gray-200 lg:hidden mobile-menu dark:border-gray-700 transition-all duration-300 ease-in-out"
      [class.h-0]="!isMenuOpen"
      [class.opacity-0]="!isMenuOpen"
      [class.overflow-hidden]="!isMenuOpen"
    >
      <div class="space-y-2">
        <a 
          *ngFor="let item of navItems[language]" 
          [routerLink]="item.route"
          routerLinkActive="text-blue-600 dark:text-blue-400 font-semibold"
          [routerLinkActiveOptions]="{ exact: item.route === '/' }"
          class="block px-4 py-2 font-medium text-gray-700 transition-colors rounded-lg dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 hover:bg-gray-100 dark:hover:bg-gray-800"
          (click)="closeMenu()"
        >
          {{ item.label }}
        </a>

        <!-- Mobile User Actions -->
        <div class="flex px-4 py-2 space-x-2">
          <!-- Cart -->
          <a routerLink="/cart" class="relative p-2 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">
            <i class="text-lg fa-solid fa-cart-shopping text-gray-700 dark:text-gray-300"></i>
            <span class="absolute flex items-center justify-center w-5 h-5 text-xs text-white bg-blue-600 rounded-full -top-1 -right-1">3</span>
          </a>
        </div>

        <!-- User Section -->
        <div class="px-4 space-y-2 ">
          <ng-container *ngIf="isLoggedIn; else mobileGuest">
            <!-- Mobile User Menu -->
            <div class="space-y-1 text-gray-700 dark:text-gray-300">
              <button 
                (click)="toggleUserMenu()"
                class="flex items-center justify-between w-full p-2 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"
              >
                <div class="flex items-center ">
                  <i class="text-lg fa-solid fa-user"></i> 
                  <span class="ms-2">{{ language === 'en' ? 'Account' : 'حسابي' }}</span>
                </div>
                <i class="fa-solid" [ngClass]="isUserMenuOpen ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
              </button>
              
              <!-- Mobile User Dropdown -->
              <div *ngIf="isUserMenuOpen" class="pl-4 space-y-1">
                <a 
                  *ngFor="let item of userMenuItems[language]"
                  [routerLink]="item.action ? null : item.route"
                  (click)="handleUserMenuItemClick(item, true)"
                  class="flex items-center px-4 py-2 text-sm text-gray-700 transition-colors rounded-lg hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700 cursor-pointer"
                >
                  <i class="w-5 fa-solid" [ngClass]="item.icon"></i>
                  <span class="ml-2">{{ item.label }}</span>
                </a>
              </div>
            </div>
          </ng-container>
          <ng-template #mobileGuest>
            <div class="grid grid-cols-2 gap-2">
              <a [routerLink]="'/login'" class="px-3 py-2 text-sm font-medium text-center text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors">
                {{ language === 'ar' ? 'سجل الدخول' : 'Login' }}
              </a>
              <a [routerLink]="'/register'" class="px-3 py-2 text-sm font-medium text-center text-blue-600 border border-blue-600 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-800 transition-colors">
                {{ language === 'ar' ? 'سجل لأول مره' : 'Register' }}
              </a>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </nav>
</div>